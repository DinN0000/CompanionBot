# 상태 피드백 시스템 개선

## 개요

사용자에게 봇이 무엇을 하고 있는지 명확하게 알려주는 피드백 시스템.

## 구현된 개선사항

### 1. Typing Indicator 자동 갱신

**문제**: 텔레그램의 "typing..." 상태는 5초 후 자동 만료됨.

**해결**: `TypingIndicator` 클래스가 4초마다 자동 갱신.

```typescript
const typingIndicator = new TypingIndicator(ctx);
typingIndicator.start();  // 4초마다 자동 갱신
// ... 작업 ...
typingIndicator.stop();   // 작업 완료 시 중지
```

**적용 위치**: 사진 처리 핸들러 (긴 API 호출 중 유지)

---

### 2. 도구별 친화적 상태 메시지

**문제**: `"🔧 web_search, get_weather 사용 중..."` - 기술적 도구명 그대로 표시

**해결**: 각 도구에 한국어 친화적 메시지 매핑

| 도구명 | 표시 메시지 | 예상 시간 |
|--------|-------------|-----------|
| web_search | 🔍 웹에서 검색하는 중 | 5-10초 |
| get_weather | 🌤️ 날씨 확인 중 | 2-3초 |
| read_file | 📖 파일 읽는 중 | 1초 |
| memory_search | 🧠 기억 검색 중 | 1-2초 |
| ... | ... | ... |

전체 매핑은 `src/config/constants.ts`의 `TOOL_STATUS_MESSAGES` 참조.

---

### 3. 진행 단계 표시

**문제**: 현재 무슨 단계인지 모름

**해결**: 단계별 시각적 피드백

```
1. 💭 생각하는 중...        (thinking 활성화 시)
2. 💭 응답 준비 중...       (thinking 비활성화 시)
3. 🔍 웹에서 검색하는 중... (도구 사용 시)
4. ▌ [응답 텍스트]          (스트리밍 중)
5. [최종 응답]              (완료)
```

---

### 4. 긴 작업 추가 피드백

**문제**: 도구가 오래 걸릴 때 무반응

**해결**: 5초 경과 시 추가 피드백

```
🔍 웹에서 검색하는 중...
⏳ 8초 경과... 조금만 기다려줘!
```

---

### 5. 예상 대기 시간 안내

**문제**: 얼마나 기다려야 하는지 모름

**해결**: 도구 사용 시 예상 시간 표시

```
🔍 웹에서 검색하는 중... (약 5-10초)
```

---

## 설정 (`src/config/constants.ts`)

```typescript
export const TELEGRAM = {
  // Typing indicator 갱신 간격 (4초 - 5초 만료 전)
  TYPING_REFRESH_MS: 4000,
  
  // 도구별 상태 메시지
  TOOL_STATUS_MESSAGES: {
    web_search: { icon: "🔍", text: "웹에서 검색하는 중", estimate: "5-10초" },
    get_weather: { icon: "🌤️", text: "날씨 확인 중", estimate: "2-3초" },
    // ...
  },
  // ...
};
```

---

## 사용 예시

### 일반 대화

```
사용자: 오늘 서울 날씨 어때?
봇:     💭 생각하는 중...
봇:     🌤️ 날씨 확인 중... (약 2-3초)
봇:     🌤️ 날씨 확인 중
        
        서울 오늘 날씨는 맑고 기온은 15도야! 🌞
```

### 복잡한 작업

```
사용자: 최신 AI 뉴스 검색해서 요약해줘
봇:     💭 생각하는 중...
봇:     🔍 웹에서 검색하는 중... (약 5-10초)
봇:     🔍 웹에서 검색하는 중...
        ⏳ 7초 경과... 조금만 기다려줘!
봇:     🔍 웹에서 검색하는 중
        
        [검색 결과 요약...]
```

---

## 향후 개선 가능

1. **진행률 바**: 도구 실행 진행률 표시 (현재 API 한계로 불가)
2. **취소 버튼**: 긴 작업 중 취소 옵션
3. **예상 시간 학습**: 실제 실행 시간 기반 예측 개선
